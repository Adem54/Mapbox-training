<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="utf-8" />
<title>1) Hover Popup (queryRenderedFeatures)</title>
<meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no"/>
<link href="https://api.mapbox.com/mapbox-gl-js/v3.14.0/mapbox-gl.css" rel="stylesheet">
<style>
  html,body {margin:0;height:100%}
  #map {height:100vh}
</style>
</head>
<body>
<div id="map"></div>

<script src="https://api.mapbox.com/mapbox-gl-js/v3.14.0/mapbox-gl.js"></script>
<script>
  mapboxgl.accessToken = 'pk.eyJ1IjoiYWRlbS01NCIsImEiOiJjbWFsM3R4d2MwNGtmMmpzZnk2ZW5tcGRsIn0.aCSC5Pe3IUcHI8MDeCTwxw';


  // Basit demo verisi: iki "müzik" noktası
  const musicGeoJSON = {
    "type":"FeatureCollection",
    "features":[
      {"type":"Feature","id":"trk-1","properties":{"name":"Cool Track","artist":"DJ Sample","icon":"music"},
       "geometry":{"type":"Point","coordinates":[28.9784,41.0082]}}, // İstanbul
      {"type":"Feature","id":"trk-2","properties":{"name":"Lo-Fi Beats","artist":"Anon","icon":"music"},
       "geometry":{"type":"Point","coordinates":[29.025,41.05]}}
    ]
  };

  const map = new mapboxgl.Map({
    container:'map',
    style:'mapbox://styles/mapbox/streets-v12',
    center:[28.99,41.03],
    zoom:11
  });

  map.on('load', () => {
    // Kaynak + symbol layer
    map.addSource('music', { type:'geojson', data: musicGeoJSON, promoteId: 'id' });

    map.addLayer({
      id:'music-symbols',
      type:'symbol',
      source:'music',
      layout:{
        'icon-image': 'music-15',       // Mapbox Maki ikonu
        'icon-allow-overlap': true,
        'text-field': ['get','name'],
        'text-offset':[0,1.2],
        'text-size': 12
      },
      paint:{
        'text-color':'#111'
      }
    });

    let currentPopup = null;

    map.on('mouseenter', 'music-symbols', (e) => {
      map.getCanvas().style.cursor = 'pointer';
      const f = e.features && e.features[0];
      if (!f) return;
      const coords = f.geometry.coordinates;
      const html = `<b>${f.properties.name}</b><br><small>${f.properties.artist||''}</small>`;

      if (currentPopup) currentPopup.remove();
      currentPopup = new mapboxgl.Popup({ closeButton:false, offset: 12 })
        .setLngLat(coords)
        .setHTML(html)
        .addTo(map);
    });

    map.on('mouseleave', 'music-symbols', () => {
      map.getCanvas().style.cursor = '';
      if (currentPopup) { currentPopup.remove(); currentPopup = null; }
    });
  });
</script>
</body>
</html>
