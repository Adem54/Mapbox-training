
<!doctype html>
<html lang="tr">
<head>
  <meta charset="utf-8" />
  <title>Mapbox – Araç Takip (Tırtıklı İz, Rota Önceden Yok)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="https://api.mapbox.com/mapbox-gl-js/v3.14.0/mapbox-gl.css" rel="stylesheet">
<script src="https://api.mapbox.com/mapbox-gl-js/v3.14.0/mapbox-gl.js"></script>
  <style>
    html,body,#map { height:100%; margin:0 }
    .legend{
      position:absolute; z-index:1; top:10px; left:10px; background:#fff; padding:8px 10px;
      border-radius:8px; box-shadow:0 2px 10px rgba(0,0,0,.1);
      font:14px/1.35 system-ui, -apple-system, Segoe UI, Roboto, sans-serif
    }
    .car {
      width:36px; height:36px;
      background-repeat:no-repeat; background-position:center; background-size:contain;
      background-image:url('data:image/svg+xml;utf8,<svg width="64" height="64" viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg"><g fill="none" stroke="none"><rect x="20" y="6" width="24" height="52" rx="8" fill="%23006EE6"/><rect x="23" y="10" width="18" height="12" rx="3" fill="%23B3D4FF"/><rect x="23" y="42" width="18" height="12" rx="3" fill="%239DC6FF"/><circle cx="22" cy="18" r="3" fill="%23222"/><circle cx="42" cy="18" r="3" fill="%23222"/><circle cx="22" cy="46" r="3" fill="%23222"/><circle cx="42" cy="46" r="3" fill="%23222"/><rect x="18" y="26" width="28" height="12" rx="2" fill="%230055B3"/></g></svg>');
      transform-origin: 50% 50%;
      filter: drop-shadow(0 1px 4px rgba(0,0,0,.4));
    }
  </style>
</head>
<body>
<div id="map" style="height: 500px;"></div>
</body>
<script>
	mapboxgl.accessToken = 'pk.eyJ1IjoiYWRlbS01NCIsImEiOiJjbWFsM3R4d2MwNGtmMmpzZnk2ZW5tcGRsIn0.aCSC5Pe3IUcHI8MDeCTwxw';

const map = new mapboxgl.Map({
  container: 'map',
  style: 'mapbox://styles/mapbox/streets-v12',
  center: [28.9795, 41.0151], zoom: 11
});

async function optimize() {
  const coords = [
    [28.9795,41.0151], [29.0120,41.0450], [28.9920,41.0270], [29.0250,41.0400]
  ].map(c => c.join(',')).join(';');

  const url = `https://api.mapbox.com/optimized-trips/v1/mapbox/driving-traffic/${coords}` +
              `?roundtrip=false&source=first&destination=last&steps=true&geometries=geojson&access_token=${mapboxgl.accessToken}`;
  const data = await (await fetch(url)).json();
  const trip = data.trips?.[0];
  if (!trip) return;

  map.on('load', () => {
    map.addSource('route', { type:'geojson', data: trip.geometry });
    map.addLayer({ id:'route', type:'line', source:'route', paint:{ 'line-width':5, 'line-color':'#3b82f6' }});
  });
}
optimize();
</script>
<!-- 
İki entegrasyon yolu
A) Doğrudan Ön Yüz → Mapbox (en hızlı)

Akış: Browser → (pk token) → Mapbox
Artı: En hızlı başlama, daha az backend işi
Eksi: Kota/ücret kontrolü zor, token görünür, karmaşık kısıtları tarayıcıda kurmak zor

Mini örnek (v1, tarayıcıdan GET):
Bu, doğrudan entegrasyondur. Token tarayıcıda, Mapbox’a giden istekler ağ sekmesinde görünür.



Saha akışı (özet mimari)

Sürücü uygulaması (iOS/Android veya PWA):

Telefon GPS’inden anlık konum alır (her 5–15 s / 30–100 m).

Konumu sizin backend’inize gönderir (WebSocket/HTTP).

Sizin backend’iniz:

Günün duraklarını (geocode ile) ve kısıtları tutar.

İlk kalkış noktasını “sürücünün o anki konumu” yapar.

Mapbox Optimization v1 (tek araç) veya v2 (çok araç + kısıt) çağırır.

Dönüş rotasını frontende/sürücü app’ine basar.

Ön yüz:

Rotayı çizer, talimatları gösterir.

Sürücü sapınca ya da yeni sipariş gelince yeniden optimize edilir.

Not: Eğer turn-by-turn istiyorsanız Mapbox Navigation SDK (iOS/Android) işinizi kolaylaştırır; GPS’i yola “snap” eder, sapınca yeniden yönlendirir.
-->